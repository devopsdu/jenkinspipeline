pipeline {
    agent {
    label 'agent1'
    }
    options {
  timeout(activity: true, time: 10)
   buildDiscarder logRotator(artifactDaysToKeepStr: '', artifactNumToKeepStr: '', daysToKeepStr: '3', numToKeepStr: '3')
   }

     stages {
          stage('checkout'){
            steps{
               git branch: 'master', url: 'https://github.com/thulasiv199/jenkinspipeline.git'
            }
        }
            stage('build'){
                steps{
                    sh "echo $PATH"
                    sh "mvn clean install" 
                }
            }
            stage('test'){
               steps{
                  sh "mvn test"
                  junit allowEmptyResults: true, testResults: 'target/surefire-reports/*.xml'
                  }
                  }
            stage('deploy'){
               steps{
                 echo "deloying to dev environment"
                 sshagent(['maven-cd-key']){
                    sh "scp -o StrictHostKeyChecking=no taget/my-app-1.0-SNAPSHOT.jar ec2-user@172.31.9.66:/home/ec2-user"     
                 }
            }
         }
      }
     post{
         always{
              deleteDir()
               }
              failure{
                echo "send an email"
                }
               success{
                echo "build is success"
                }
                }
 }
